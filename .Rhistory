region = unlist(lapply(strsplit(links_all_girls, "/"),
function( i_str ) {
tmp_region <- i_str[4]
}
)),
girl_id = unlist(lapply(strsplit(links_all_girls, "/"),
function( i_str ) {
tmp_id <- i_str[5]
}
))
)
View(dtf_links_all_girls)
save(dtf_links_all_girls, file = "data_intermediate/dtf_links_all_girls.rda")
View(dtf_links_all_girls)
View(dtf_links_all_regions)
View(dtf_links_all_girls)
## Close the web browser and stop the server
remDr$close()
remote_driver$server$stop()
load("data_intermediate/dtf_links_all_girls.rdr")
load("data_intermediate/dtf_links_all_girls.rdr")
load("data_intermediate/dtf_links_all_girls.rda")
View(dtf_links_all_girls)
dtf_links_all_girls %>%
filter( girl_id == "escorts" ) %>%  ## agency ad
filter( !grep("nzpc",girl_id ))
grepl("nzpc", nzgirls-nzpc-16666)
grepl("nzpc", "nzgirls-nzpc-16666")
dtf_links_all_girls %>%
filter( girl_id == "escorts" ) %>%  ## agency ad
filter( !grepl("nzpc",girl_id ) )
dtf_links_all_girls %>%
dplyr::filter( girl_id == "escorts" ) %>%  ## agency ad
dplyr::filter( !grepl("nzpc",girl_id ) )
dtf_links_all_girls %>%
dplyr::filter( girl_id != "escorts" ) %>%  ## agency ad
dplyr::filter( !grepl("nzpc",girl_id ) )
## clean the data a bit
dtf_links_all_girls_cl <-
dtf_links_all_girls %>%
dplyr::filter( girl_id != "escorts" ) %>%  ## agency ad
dplyr::filter( !grepl("nzpc",girl_id ) )
View(dtf_links_all_girls_cl)
girl_link <- "https://www.newzealandgirls.co.nz/auckland-escorts/nzgirls-ladygabriella-36842
"
girl_link <- "https://www.newzealandgirls.co.nz/auckland-escorts/nzgirls-ladygabriella-36842"
## start page
remDr$navigate(girl_link)
## load data
load("data_intermediate/dtf_links_all_girls.rda")
## clean the data a bit
dtf_links_all_girls_cl <-
dtf_links_all_girls %>%
dplyr::filter( girl_id != "escorts" ) %>%  ## agency ad
dplyr::filter( !grepl("nzpc",girl_id ) ) ## NZPC ad
View(dtf_links_all_girls)
girl_link <- "https://www.newzealandgirls.co.nz/auckland-escorts/nzgirls-ladygabriella-36842"
## start page
remDr$navigate(girl_link)
## get about me info
about_me <- remDr$findElements(using = "class name", "row gap")
about_me <- remDr$findElements(using = "css selector", ".row.gap")
about_me[[1]]
about_me[[1]]$getElementAttribute()
about_me[[1]]$getElementTagName()
about_me[[1]]$getElementText()
about_me[[2]]$getElementText()
about_me[[3]]$getElementText()
## load data
load("data_intermediate/dtf_links_all_girls.rda")
## clean the data a bit
dtf_links_all_girls_cl <-
dtf_links_all_girls %>%
dplyr::filter( girl_id != "escorts" ) %>%  ## agency ad
dplyr::filter( !grepl("nzpc",girl_id ) ) ## NZPC ad
View(dtf_links_all_girls_cl)
girl_link <- "https://www.newzealandgirls.co.nz/auckland-escorts/nzgirls-ladygabriella-36842
"
girl_link <- "https://www.newzealandgirls.co.nz/auckland-escorts/nzgirls-ladygabriella-36842"
## start page
remDr$navigate(girl_link)
## get about me info
about_me_element <- remDr$findElements(using = "css selector", ".row.gap")
about_me_list <- lapply( about_me_element,
function(i_girl){
i_girl$getElementAttribute("href")
} )
about_me[[3]]$getElementText()
about_me_list
about_me_element
about_me_text <-lapply( about_me_element,
function(i_girl){
i_girl$getElementText()
} )
View(about_me_text)
about_me_text <-unlist(lapply( about_me_element,
function(i_girl){
i_girl$getElementText()
} ))
about_me_text
strsplit( about_me_text, "\n")
lapply(strsplit( about_me_text, "\n"),
function(i){
tmp_dtf <- data.frame(i[1], i[2])
})
lapply(strsplit( about_me_text, "\n"),
function(i){
tmp_col <- i[1]
tmp_value <- i[2]
})
lapply(strsplit( about_me_text, "\n"),
function(i){
tmp_col <- i[1]
tmp_value <- i[2]
tmp_dtf <- as.data.frame(t(as.matrix(tmp_value)))
colnames(tmp_dtf) <- tmp_col
return( tmp_dtf )
})
tmp_abm <-
lapply(strsplit( about_me_text, "\n"),
function(i){
tmp_col <- i[1]
tmp_value <- i[2]
tmp_dtf <- as.data.frame(t(as.matrix(tmp_value)))
colnames(tmp_dtf) <- tmp_col
return( tmp_dtf )
})
bind_cols(tmp_abm)
construct_girl_info_nzg <-
function( girl_link, sleep_time = 2){
## start page
remDr$navigate(girl_link)
Sys.sleep(sleep_time )
## get about me info
about_me_element <- remDr$findElements(using = "css selector", ".row.gap")
## find about me
about_me_text <-unlist(lapply( about_me_element,
function(i_girl){
i_girl$getElementText()
} ))
## to a data frame
tmp_abm <-
lapply(strsplit( about_me_text, "\n"),
function(i_abm){
tmp_col <- i_abm[1]
tmp_value <- i_abm[2]
tmp_dtf <- as.data.frame(t(as.matrix(tmp_value)))
colnames(tmp_dtf) <- tmp_col
return( tmp_dtf )
})
bind_cols(tmp_abm)
}
construct_girl_info_nzg <-
function( girl_link, sleep_time = 2){
## start page
remDr$navigate(girl_link)
Sys.sleep(sleep_time )
## get about me info
about_me_element <- remDr$findElements(using = "css selector", ".row.gap")
## find about me
about_me_text <-unlist(lapply( about_me_element,
function(i_girl){
i_girl$getElementText()
} ))
## to a data frame
tmp_abm <-
lapply(strsplit( about_me_text, "\n"),
function(i_abm){
tmp_col <- i_abm[1]
tmp_value <- i_abm[2]
tmp_dtf <- as.data.frame(t(as.matrix(tmp_value)))
colnames(tmp_dtf) <- tolower(tmp_col)
return( tmp_dtf )
})
return(bind_cols(tmp_abm))
}
tmp_girl_list <- NULL
for(i in 1:nrow(dtf_links_all_girls_cl)){
tmp_girl_link <-
dtf_links_all_girls_cl$url_girl
tmp_dtf_girl_about_me <-
construct_girl_info_nzg(tmp_girl_link)
tmp_girl_list[[i]] <-
bind_cols(dtf_links_all_girls_cl[i,c("girl_id","region")],
tmp_dtf_girl_about_me)
}
i
load("data_intermediate/dtf_links_all_girls.rda")
## clean the data a bit
dtf_links_all_girls_cl <-
dtf_links_all_girls %>%
dplyr::filter( girl_id != "escorts" ) %>%  ## agency ad
dplyr::filter( !grepl("nzpc",girl_id ) ) ## NZPC ad
##
tmp_girl_list <- NULL
no_of_girls <- nrow(dtf_links_all_girls_cl)
for(i in 1:no_of_girls){
print(paste0(i, "out of ", no_of_girls) )
tmp_girl_link <-
dtf_links_all_girls_cl$url_girl
tmp_dtf_girl_about_me <-
construct_girl_info_nzg(tmp_girl_link, sleep_time = 0.5)
tmp_girl_list[[i]] <-
bind_cols(dtf_links_all_girls_cl[i,c("girl_id","region")],
tmp_dtf_girl_about_me)
}
## construct girls info from nzg
construct_girl_info_nzg <-
function( girl_link, sleep_time = 2){
## start page
remDr$navigate(girl_link)
Sys.sleep(sleep_time )
## get about me info
about_me_element <- remDr$findElements(using = "css selector", ".row.gap")
## find about me
about_me_text <-unlist(lapply( about_me_element,
function(i_girl){
i_girl$getElementText()
} ))
## to a data frame
tmp_abm <-
lapply(strsplit( about_me_text, "\n"),
function(i_abm){
tmp_col <- i_abm[1]
tmp_value <- i_abm[2]
tmp_dtf <- as.data.frame(t(as.matrix(tmp_value)))
colnames(tmp_dtf) <- tolower(tmp_col)
return( tmp_dtf )
})
return(bind_cols(tmp_abm))
}
dtf_girls_abm <- bind_rows(tmp_girl_list)
View(dtf_girls_abm)
## load data
load("data_intermediate/dtf_links_all_girls.rda")
## clean the data a bit
dtf_links_all_girls_cl <-
dtf_links_all_girls %>%
dplyr::filter( girl_id != "escorts" ) %>%  ## agency ad
dplyr::filter( !grepl("nzpc",girl_id ) ) ## NZPC ad
##
tmp_girl_list <- NULL
no_of_girls <- nrow(dtf_links_all_girls_cl)
for(i in 1:no_of_girls){
print(paste0(i, " out of ", no_of_girls) )
tmp_girl_link <-
dtf_links_all_girls_cl$url_girl
tmp_dtf_girl_about_me <-
construct_girl_info_nzg(tmp_girl_link, sleep_time = 1)
tmp_girl_list[[i]] <-
bind_cols(dtf_links_all_girls_cl[i,c("girl_id","region")],
tmp_dtf_girl_about_me)
}
1
tmp_girl_link
## load data
load("data_intermediate/dtf_links_all_girls.rda")
## clean the data a bit
dtf_links_all_girls_cl <-
dtf_links_all_girls %>%
dplyr::filter( girl_id != "escorts" ) %>%  ## agency ad
dplyr::filter( !grepl("nzpc",girl_id ) ) ## NZPC ad
##
tmp_girl_list <- NULL
no_of_girls <- nrow(dtf_links_all_girls_cl)
for(i in 1:no_of_girls){
print(paste0(i, " out of ", no_of_girls) )
tmp_girl_link <-
dtf_links_all_girls_cl$url_girl[i]
tmp_dtf_girl_about_me <-
construct_girl_info_nzg(tmp_girl_link, sleep_time = 1)
tmp_girl_list[[i]] <-
bind_cols(dtf_links_all_girls_cl[i,c("girl_id","region")],
tmp_dtf_girl_about_me)
}
dtf_girls_abm <- bind_rows(tmp_girl_list)
View(dtf_girls_abm)
tmp_girl_list <- NULL
no_of_girls <- nrow(dtf_links_all_girls_cl)
for(i in 1:no_of_girls){
print(paste0(i, " out of ", no_of_girls) )
tmp_girl_link <-
dtf_links_all_girls_cl$url_girl[i]
tmp_dtf_girl_about_me <-
construct_girl_info_nzg(tmp_girl_link, sleep_time = 0)
tmp_girl_list[[i]] <-
bind_cols(dtf_links_all_girls_cl[i,c("girl_id","region")],
tmp_dtf_girl_about_me)
}
dtf_girls_abm <- bind_rows(tmp_girl_list)
View(dtf_girls_abm)
## get price info
price_element <- remDr$findElements(using = "css selector", ".price-list")
price_element[[1]]$getElementText()
price_element[[2]]$getElementText()
price_element[[1]]
price_element[[1]]$getElementText()
price_element <- remDr$findElements(using = "css selector", ".row")
price_element[[1]]$getElementText()
price_element[[2]]$getElementText()
price_element[[3]]$getElementText()
price_element[[4]]$getElementText()
price_element[[5]]$getElementText()
price_element[[6]]$getElementText()
price_element[[7]]$getElementText()
price_element[[8]]$getElementText()
## get price info
price_element <- remDr$findElements(using = "class name", "row")
price_element[[1]]$getElementText()
price_element[[2]]$getElementText()
price_element[[4]]$getElementText()
price_element[[63]]$getElementText()
price_element[[60]]$getElementText()
price_element[[10]]$getElementText()
price_element[[11]]$getElementText()
price_element[[12]]$getElementText()
price_element[[20]]$getElementText()
price_element[[25]]$getElementText()
price_element[[24]]$getElementText()
price_element[[23]]$getElementText()
## get price info
price_element <- remDr$findElements(using = "css selector", ".price-list")
price_text <-unlist(lapply( price_element,
function(i_price){
i_pricel$getElementText()
} ))
## get price info
price_element <- remDr$findElements(using = "css selector", ".price-list")
## find about me
price_text <-unlist(lapply( price_element,
function(i_price){
i_price$getElementText()
} ))
price_text
## deal with price info
strsplit( price_text )
strsplit( price_text , "\n")
price_element[[2]]
price_element[[1]]
price_element[[1]]$findChildElement("css selector", ".row")
tmp <- price_element[[1]]$findChildElement("css selector", ".row")
tmp
tmp$getElementText()
tmp[1]$getElementText()
tmp[[1]]$getElementText()
tmp$getElementText()
tmp <- price_element[[1]]$findChildElements("css selector", ".row")
tmp[[1]]$getElementText()
tmp[[2]]$getElementText()
## get price info
price_element_raw <-
remDr$findElements(using = "css selector", ".price-list")
price_element <-
price_element_raw[[1]]$findChildElements("css selector", ".row")
## find about me
price_text <-unlist(lapply( price_element_raw,
function(i_price){
i_price$getElementText()
} ))
price_text
## find about me
price_text <-unlist(lapply( price_element,
function(i_price){
i_price$getElementText()
} ))
price_text
## get price info
price_element_raw <-
remDr$findElements(using = "css selector", ".price-list")
price_element <-
price_element_raw[[1]]$findChildElements("css selector", ".row")
## find about me
price_text <-unlist(lapply( price_element,
function(i_price){
i_price$getElementText()
} ))
## to a data frame
tmp_price <-
lapply(strsplit( price_text, "\n"),
function(i_price){
tmp_col <- i_time[1]
tmp_value <- i_price[2]
tmp_dtf <- as.data.frame(t(as.matrix(tmp_value)))
colnames(tmp_dtf) <- tolower(tmp_col)
return( tmp_dtf )
})
## get price info
price_element_raw <-
remDr$findElements(using = "css selector", ".price-list")
price_element <-
price_element_raw[[1]]$findChildElements("css selector", ".row")
## find about me
price_text <-unlist(lapply( price_element,
function(i_price){
i_price$getElementText()
} ))
## to a data frame
tmp_price <-
lapply(strsplit( price_text, "\n"),
function(i_price){
tmp_col <- i_price[1]
tmp_value <- i_price[2]
tmp_dtf <- as.data.frame(t(as.matrix(tmp_value)))
colnames(tmp_dtf) <- tolower(tmp_col)
return( tmp_dtf )
})
tmp_dtf_price <- bind_cols(tmp_price)
View(tmp_price)
View(tmp_dtf_price)
## utility functions
## based on the reginoal url to construct all pages
construct_region_link_nzg <-
function( region_base_url, sleep_time = 2 ){
## start page
remDr$navigate(region_base_url)
Sys.sleep(sleep_time )
more_page <- remDr$findElements(using = 'class name',value = 'more-pages-menu')
tmp_page_txt <- more_page[[1]]$getElementText()[[1]]
if(tmp_page_txt != ""){
tmp_page_num <- str_extract_all(tmp_page_txt, "\\d+")[[1]]
tmp_page_num_ind <- strsplit(tmp_page_num, split = "")[[1]]
tmp_page_num_ind <- tmp_page_num_ind[1:(length(tmp_page_num_ind)-1)]
tmp_all_links <- paste0(region_base_url, "?pos=", tmp_page_num_ind)
return( c(region_base_url, tmp_all_links) )
}else{
return(region_base_url)
}
}
### based on all regional links to get all girls
construct_girl_link_nzg <-
function( region_link, sleep_time = 2){
## start page
remDr$navigate(region_link)
Sys.sleep(sleep_time )
## find girls card
tmp_girl_card <- remDr$findElements(using = 'css selector',value = '.wrap-link.esc-link')
## find href
tmp_list <- lapply( tmp_girl_card,
function(i_girl){
i_girl$getElementAttribute("href")
} )
return( unlist(tmp_list) )
}
## construct girls info from nzg
construct_girl_info_nzg <-
function( girl_link, sleep_time = 2){
## start page
remDr$navigate(girl_link)
Sys.sleep(sleep_time )
## get about me info
about_me_element <- remDr$findElements(using = "css selector", ".row.gap")
## find about me
about_me_text <-unlist(lapply( about_me_element,
function(i_girl){
i_girl$getElementText()
} ))
## to a data frame
tmp_abm <-
lapply(strsplit( about_me_text, "\n"),
function(i_abm){
tmp_col <- i_abm[1]
tmp_value <- i_abm[2]
tmp_dtf <- as.data.frame(t(as.matrix(tmp_value)))
colnames(tmp_dtf) <- tolower(tmp_col)
return( tmp_dtf )
})
tmp_dtf_abm <- bind_cols(tmp_abm)
## get price info
price_element_raw <-
remDr$findElements(using = "css selector", ".price-list")
price_element <-
price_element_raw[[1]]$findChildElements("css selector", ".row")
## find about me
price_text <-unlist(lapply( price_element,
function(i_price){
i_price$getElementText()
} ))
## to a data frame
tmp_price <-
lapply(strsplit( price_text, "\n"),
function(i_price){
tmp_col <- i_price[1]
tmp_value <- i_price[2]
tmp_dtf <- as.data.frame(t(as.matrix(tmp_value)))
colnames(tmp_dtf) <- tolower(tmp_col)
return( tmp_dtf )
})
tmp_dtf_price <- bind_cols(tmp_price)
return( bind_cols(tmp_dtf_girl_about_me,
tmp_dtf_price) )
}
no_of_girls = 20
## clean the data a bit
dtf_links_all_girls_cl <-
dtf_links_all_girls %>%
dplyr::filter( girl_id != "escorts" ) %>%  ## agency ad
dplyr::filter( !grepl("nzpc",girl_id ) ) ## NZPC ad
##
tmp_girl_list <- NULL
no_of_girls <- nrow(dtf_links_all_girls_cl)
for(i in 1:no_of_girls){
print(paste0(i, " out of ", no_of_girls) )
tmp_girl_link <-
dtf_links_all_girls_cl$url_girl[i]
tmp_dtf_girl_about_me <-
construct_girl_info_nzg(tmp_girl_link, sleep_time = 0)
tmp_girl_list[[i]] <-
bind_cols(dtf_links_all_girls_cl[i,c("girl_id","region")],
tmp_dtf_girl_about_me)
}
dtf_girls_info <- bind_rows(tmp_girl_list)
View(dtf_girls_info)
